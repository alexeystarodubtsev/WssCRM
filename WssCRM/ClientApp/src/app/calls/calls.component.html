<h1>Звонки</h1>
<Search-Panel [curFlt] ="curFlt"></Search-Panel>
<div>{{name}}</div>
<ng-container *ngIf="!loading">

  <button type="button" class="btn btn-sm btn-success" (click)="getCalls()">Получить звонки</button>

  <table class="table table-striped" *ngIf="callslist; else changecall" style="margin-bottom:30px">

    <thead>
      <tr>
        <th>№</th>
        <th>Клиент</th>
        <th>Этап</th>
        <th>Менеджер</th>
        <th>Дата</th>
        <th></th>
      </tr>
    </thead>
    <tbody>

      <tr *ngFor="let c of calls; let i = index">
        <td>
          {{i+1 + (curFlt.pageNumber - 1) * 20}}
        </td>
        <td>{{c.clientName}}</td>
        <td>
          <div *ngFor="let s of c.stages">
            {{s.name}}
          </div>
        </td>
        <td>{{c.manager.name}}</td>
        <td>
          <mat-form-field class="fullwidth">
            <input matInput [matDatepicker]="mymatdate" placeholder="Дата звонка" [readonly]="true" [(ngModel)]="c.date">
            <mat-datepicker #mymatdate></mat-datepicker>
          </mat-form-field>
        </td>
        <td>
          <!--<button class="btn btn-sm btn-primary" [routerLink]="['/call', c.id]" >Перейти к звонку</button>-->
          <button class="btn btn-sm btn-primary" (click)="OpenCall(c.id)">Перейти к звонку</button>
        </td>
      </tr>
    </tbody>

  </table>
  <div class="footer">
    <ngb-pagination [(page)]="curFlt.pageNumber"
                    [pageSize]="20"
                    [collectionSize]="pageSize * 20"
                    (pageChange)="pageChanged()"
                    [maxSize]="3"
                    [rotate]="true">

    </ngb-pagination>
  </div>
  <ng-template #changecall>
    <button class="btn btn-sm btn-primary" (click)="returnCalls()">Вернуться ко всем звонкам</button>
    <app-call [call]="call"></app-call>
  </ng-template>
</ng-container>
